var e=require("exifr"),t=require("tz-lookup"),n=require("arrify"),l=require("@chriscdn/to-date"),i=require("@chriscdn/format-date");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var l=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,t}var o=/*#__PURE__*/r(e),a=/*#__PURE__*/r(t),c=/*#__PURE__*/r(n),m=function(e){var t=null==e?void 0:e.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(t){var n=t[2],l=t[3],i=parseInt(t[1],10)+parseFloat(n)/60;return"S"!==l&&"W"!==l||(i*=-1),i}return null},f=function(e,t){if("number"==typeof e){var n=Math.pow(10,t);return Math.round(e*n)/n}return null},s=function(e){return"number"==typeof e&&Number.isFinite(e)},d=o.default.parse;exports.exif=function(e){try{var t={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,title:null,caption:null,width:0,height:0,city:null,state:null,country:null,countryCode:null,rating:null,mimetype:null,keywords:[]};return Promise.resolve(d(e,!0)).then(function(n){var r,o,d,h,g,v,p,y,w=(v=null!=(o=null!=(d=(r=n).latitude)?d:m(r.GPSLatitude))?o:null,p=null!=(h=null!=(g=r.longitude)?g:m(r.GPSLongitude))?h:null,y=s(v)&&s(p)?a.default(v,p):null,{latitude:f(v,6),longitude:f(p,6),timeZone:y});t.latitude=w.latitude,t.longitude=w.longitude,t.timeZone=w.timeZone,t.title=function(e){var t,n,l,i=null!=(t=null!=(n=null==(l=e.title)?void 0:l.value)?n:e.ObjectName)?t:null;return i?String(i).trim():null}(n),t.caption=function(e){var t,n,l,i,r=null!=(t=null!=(n=null!=(l=null==(i=e.description)?void 0:i.value)?l:e.ImageDescription)?n:e.Caption)?t:null;return r?String(r).trim():null}(n),t.city=n.City,t.state=n.State,t.country=n.Country,t.countryCode=n.CountryCode,t.rating=n.Rating,t.mimetype=n.format,t.keywords=function(e){var t,n,l;return c.default(null!=(t=null!=(n=null!=(l=e.Keywords)?l:e.subject)?n:e.weightedFlatSubject)?t:[])}(n);var T=function(e,t){var n,r,u,o,a=null!=(n=e.DateTimeOriginal)?n:null,c=null!=(r=e.OffsetTimeOriginal)?r:null;return"string"==typeof a?function(e,t){var n,r,u=l.toDate(e);return t.timeZone?{localTime:i.formatDateYYYYMMDDTHHMMSS(u,t.timeZone),timestamp:null!=(n=null==u?void 0:u.getTime())?n:null}:{localTime:e.slice(0,19),timestamp:null!=(r=null==u?void 0:u.getTime())?r:null}}(a,t):l.isDate(a)?function(e,t,n){var r=i.formatDateYYYYMMDDTHHMMSS(e);if(null!==n){var u,o=l.toDateUTC(r);return o&&(null==o||o.setMinutes(o.getUTCMinutes()-n)),{localTime:r,timestamp:null!=(u=null==o?void 0:o.getTime())?u:null}}if(t.timeZone){var a,c=l.toDateInTimeZone(r,t.timeZone);return{localTime:r,timestamp:null!=(a=null==c?void 0:c.getTime())?a:null}}return{localTime:r,timestamp:null}}(a,t,c?(u=c.split(":"),60*(o=parseInt(u[0]))+(o>0?1:-1)*parseInt(u[1])):null):{localTime:null,timestamp:null}}(n,w);return t.localTime=T.localTime,t.timestamp=T.timestamp,Promise.resolve(function(e,t){try{var n,l,i,r,o=function(){return{width:a,height:c}},a=null!=(n=null!=(l=e.ImageWidth)?l:e.ExifImageWidth)?n:0,c=null!=(i=null!=(r=e.ImageHeight)?r:e.ExifImageHeight)?i:0,m=function(){if(a>0&&c>0);else{var e=function(){if("string"==typeof t)return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return u(require("probe-image-size"))})).then(function(e){var n=e.default;return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return u(require("fs"))})).then(function(e){return Promise.resolve(n(e.createReadStream(t))).then(function(e){null!=e&&e.width&&null!=e&&e.height&&(a=e.width,c=e.height)})})});var e=function(){if(window&&"string"!=typeof t)return Promise.resolve(function(e){try{return Promise.resolve(new Promise(function(t){var n=window.URL||window.webkitURL,l=new Image;l.onload=function(){t({width:l.width,height:l.height})},l.src=n.createObjectURL(e)}))}catch(e){return Promise.reject(e)}}(t)).then(function(e){a=e.width,c=e.height})}();return e&&e.then?e.then(function(){}):void 0}();if(e&&e.then)return e.then(function(){})}}();return Promise.resolve(m&&m.then?m.then(o):o())}catch(e){return Promise.reject(e)}}(n,e)).then(function(e){return t.width=e.width,t.height=e.height,t})})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=exif.cjs.map
