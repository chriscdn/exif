var e=require("exifr"),t=require("tz-lookup"),n=require("arrify"),i=require("@chriscdn/to-date"),r=require("@chriscdn/format-date");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,t}var o=/*#__PURE__*/l(e),a=/*#__PURE__*/l(t),c=/*#__PURE__*/l(n),m=function(e){var t=null==e?void 0:e.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(t){var n=t[2],i=t[3],r=parseInt(t[1],10)+parseFloat(n)/60;return"S"!==i&&"W"!==i||(r*=-1),r}return null},f=function(e,t){if("number"==typeof e){var n=Math.pow(10,t);return Math.round(e*n)/n}return null},s=function(e){return"number"==typeof e&&Number.isFinite(e)},d=function(e){return"string"==typeof e},h=o.default.parse;exports.exif=function(e){try{var t={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,title:null,caption:null,width:0,height:0,city:null,state:null,country:null,countryCode:null,rating:null,mimetype:null,keywords:[]};return Promise.resolve(h(e,!0)).then(function(n){var l,o,h,g,v,p,y,w,T=(h=(l=n).longitude,g=l.GPSLatitude,v=l.GPSLongitude,p=s(o=l.latitude)?o:d(g)?m(g):null,y=s(o)?h:d(v)?m(v):null,w=s(p)&&s(y)?a.default(p,y):null,{latitude:f(p,6),longitude:f(y,6),timeZone:w});t.latitude=T.latitude,t.longitude=T.longitude,t.timeZone=T.timeZone,t.title=function(e){var t,n,i,r=null!=(t=null!=(n=null==(i=e.title)?void 0:i.value)?n:e.ObjectName)?t:null;return r?String(r).trim():null}(n),t.caption=function(e){var t,n,i,r,l=null!=(t=null!=(n=null!=(i=null==(r=e.description)?void 0:r.value)?i:e.ImageDescription)?n:e.Caption)?t:null;return l?String(l).trim():null}(n),t.city=n.City,t.state=n.State,t.country=n.Country,t.countryCode=n.CountryCode,t.rating=n.Rating,t.mimetype=n.format,t.keywords=function(e){var t,n,i;return c.default(null!=(t=null!=(n=null!=(i=e.Keywords)?i:e.subject)?n:e.weightedFlatSubject)?t:[])}(n);var P=function(e,t){var n,l,u,o,a=null!=(n=e.DateTimeOriginal)?n:null,c=null!=(l=e.OffsetTimeOriginal)?l:null;return"string"==typeof a?function(e,t){var n,l,u=i.toDate(e);return t.timeZone?{localTime:r.formatDateYYYYMMDDTHHMMSS(u,t.timeZone),timestamp:null!=(n=null==u?void 0:u.getTime())?n:null}:{localTime:e.slice(0,19),timestamp:null!=(l=null==u?void 0:u.getTime())?l:null}}(a,t):i.isDate(a)?function(e,t,n){var l=r.formatDateYYYYMMDDTHHMMSS(e);if(null!==n){var u,o=i.toDateUTC(l);return o&&(null==o||o.setMinutes(o.getUTCMinutes()-n)),{localTime:l,timestamp:null!=(u=null==o?void 0:o.getTime())?u:null}}if(t.timeZone){var a,c=i.toDateInTimeZone(l,t.timeZone);return{localTime:l,timestamp:null!=(a=null==c?void 0:c.getTime())?a:null}}return{localTime:l,timestamp:null}}(a,t,c?(u=c.split(":"),60*(o=parseInt(u[0]))+(o>0?1:-1)*parseInt(u[1])):null):{localTime:null,timestamp:null}}(n,T);return t.localTime=P.localTime,t.timestamp=P.timestamp,Promise.resolve(function(e,t){try{var n,i,r,l,o=function(){return{width:a,height:c}},a=null!=(n=null!=(i=e.ImageWidth)?i:e.ExifImageWidth)?n:0,c=null!=(r=null!=(l=e.ImageHeight)?l:e.ExifImageHeight)?r:0,m=function(){if(a>0&&c>0);else{var e=function(){if("string"==typeof t)return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return u(require("probe-image-size"))})).then(function(e){var n=e.default;return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return u(require("fs"))})).then(function(e){return Promise.resolve(n(e.createReadStream(t))).then(function(e){null!=e&&e.width&&null!=e&&e.height&&(a=e.width,c=e.height)})})});var e=function(){if(window&&"string"!=typeof t)return Promise.resolve(function(e){try{return Promise.resolve(new Promise(function(t){var n=window.URL||window.webkitURL,i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.src=n.createObjectURL(e)}))}catch(e){return Promise.reject(e)}}(t)).then(function(e){a=e.width,c=e.height})}();return e&&e.then?e.then(function(){}):void 0}();if(e&&e.then)return e.then(function(){})}}();return Promise.resolve(m&&m.then?m.then(o):o())}catch(e){return Promise.reject(e)}}(n,e)).then(function(e){return t.width=e.width,t.height=e.height,t})})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=exif.cjs.map
