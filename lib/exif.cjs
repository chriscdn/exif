var e=require("exifr"),t=require("tz-lookup"),n=require("@chriscdn/to-date"),i=require("@chriscdn/format-date");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,t}var u=/*#__PURE__*/r(e),o=/*#__PURE__*/r(t),a=function(e){var t=null==e?void 0:e.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(t){var n=t[2],i=t[3],r=parseInt(t[1],10)+parseFloat(n)/60;return"S"!==i&&"W"!==i||(r*=-1),r}return null},m=function(e,t){if("number"==typeof e){var n=Math.pow(10,t);return Math.round(e*n)/n}return null},c=u.default.parse;exports.exif=function(e){try{var t={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,description:null,width:0,height:0};return Promise.resolve(c(e,!0)).then(function(r){var u,c,f,s,h,d,g,v,p=(d=null!=(c=null!=(f=(u=r).latitude)?f:a(u.GPSLatitude))?c:null,g=null!=(s=null!=(h=u.longitude)?h:a(u.GPSLongitude))?s:null,v=null!==d&&null!==g?o.default(d,g):null,{latitude:m(d,6),longitude:m(g,6),timeZone:v});t.latitude=p.latitude,t.longitude=p.longitude,t.timeZone=p.timeZone,t.description=function(e){var t,n=null!=(t=e.ImageDescription)?t:null;return n?String(n).trim():null}(r);var w=function(e,t){var r,l,u,o,a=null!=(r=e.DateTimeOriginal)?r:null,m=null!=(l=e.OffsetTimeOriginal)?l:null;return"string"==typeof a?function(e,t){var r,l,u=n.toDate(e);return t.timeZone?{localTime:i.formatDateYYYYMMDDTHHMMSS(u,t.timeZone),timestamp:null!=(r=null==u?void 0:u.getTime())?r:null}:{localTime:e.slice(0,19),timestamp:null!=(l=null==u?void 0:u.getTime())?l:null}}(a,t):n.isDate(a)?function(e,t,r){var l=i.formatDateYYYYMMDDTHHMMSS(e);if(null!==r){var u,o=n.toDateUTC(l);return o&&(null==o||o.setMinutes(o.getUTCMinutes()-r)),{localTime:l,timestamp:null!=(u=null==o?void 0:o.getTime())?u:null}}if(t.timeZone){var a,m=n.toDateInTimeZone(l,t.timeZone);return{localTime:l,timestamp:null!=(a=null==m?void 0:m.getTime())?a:null}}return{localTime:l,timestamp:null}}(a,t,m?(u=m.split(":"),60*(o=parseInt(u[0]))+(o>0?1:-1)*parseInt(u[1])):null):{localTime:null,timestamp:null}}(r,p);return t.localTime=w.localTime,t.timestamp=w.timestamp,Promise.resolve(function(e,t){try{var n,i,r,u,o=function(){return{width:a,height:m}},a=null!=(n=null!=(i=e.ImageWidth)?i:e.ExifImageWidth)?n:0,m=null!=(r=null!=(u=e.ImageHeight)?u:e.ExifImageHeight)?r:0,c=function(){if(a>0&&m>0);else{var e=function(){if("string"==typeof t)return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return l(require("probe-image-size"))})).then(function(e){var n=e.default;return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return l(require("fs"))})).then(function(e){return Promise.resolve(n(e.createReadStream(t))).then(function(e){null!=e&&e.width&&null!=e&&e.height&&(a=e.width,m=e.height)})})});var e=function(){if(window&&"string"!=typeof t)return Promise.resolve(function(e){try{return Promise.resolve(new Promise(function(t){var n=window.URL||window.webkitURL,i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.src=n.createObjectURL(e)}))}catch(e){return Promise.reject(e)}}(t)).then(function(e){a=e.width,m=e.height})}();return e&&e.then?e.then(function(){}):void 0}();if(e&&e.then)return e.then(function(){})}}();return Promise.resolve(c&&c.then?c.then(o):o())}catch(e){return Promise.reject(e)}}(r,e)).then(function(e){return t.width=e.width,t.height=e.height,t})})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=exif.cjs.map
