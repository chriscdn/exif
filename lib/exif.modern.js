import t from"exifr";import l from"tz-lookup";import e from"arrify";import{isDate as n,toDate as i,toDateUTC as u,toDateInTimeZone as o}from"@chriscdn/to-date";import{formatDateYYYYMMDDTHHMMSS as r}from"@chriscdn/format-date";const a=t=>{const l=null==t?void 0:t.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(l){const[t,e,n,i]=l;let u=parseInt(e,10)+parseFloat(n)/60;return"S"!==i&&"W"!==i||(u*=-1),u}return null},m=(t,l)=>{if("number"==typeof t){const e=Math.pow(10,l);return Math.round(t*e)/e}return null},{parse:s}=t,c=async t=>{const c={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,title:null,caption:null,width:0,height:0,city:null,state:null,country:null,countryCode:null,rating:null,mimetype:null,keywords:[]},d=await s(t,!0),g=(t=>{var e,n,i,u;const o=null!=(e=null!=(n=t.latitude)?n:a(t.GPSLatitude))?e:null,r=null!=(i=null!=(u=t.longitude)?u:a(t.GPSLongitude))?i:null,s=null!==o&&null!==r?l(o,r):null;return{latitude:m(o,6),longitude:m(r,6),timeZone:s}})(d);var h,p,w,f;c.latitude=g.latitude,c.longitude=g.longitude,c.timeZone=g.timeZone,c.title=(t=>{var l,e,n;const i=null!=(l=null!=(e=null==(n=t.title)?void 0:n.value)?e:t.ObjectName)?l:null;return i?String(i).trim():null})(d),c.caption=(t=>{var l,e,n,i;const u=null!=(l=null!=(e=null!=(n=null==(i=t.description)?void 0:i.value)?n:t.ImageDescription)?e:t.Caption)?l:null;return u?String(u).trim():null})(d),c.city=d.City,c.state=d.State,c.country=d.Country,c.countryCode=d.CountryCode,c.rating=d.Rating,c.mimetype=d.format,c.keywords=e(null!=(p=null!=(w=null!=(f=(h=d).Keywords)?f:h.subject)?w:h.weightedFlatSubject)?p:[]);const y=((t,l)=>{var e,a;const m=null!=(e=t.DateTimeOriginal)?e:null,s=null!=(a=t.OffsetTimeOriginal)?a:null;return"string"==typeof m?((t,l)=>{const e=i(t);var n,u;return l.timeZone?{localTime:r(e,l.timeZone),timestamp:null!=(n=null==e?void 0:e.getTime())?n:null}:{localTime:t.slice(0,19),timestamp:null!=(u=null==e?void 0:e.getTime())?u:null}})(m,l):n(m)?((t,l,e)=>{const n=r(t);if(null!==e){var i;const t=u(n);return t&&(null==t||t.setMinutes(t.getUTCMinutes()-e)),{localTime:n,timestamp:null!=(i=null==t?void 0:t.getTime())?i:null}}if(l.timeZone){var a;const t=o(n,l.timeZone);return{localTime:n,timestamp:null!=(a=null==t?void 0:t.getTime())?a:null}}return{localTime:n,timestamp:null}})(m,l,s?(t=>{const l=t.split(":"),e=parseInt(l[0]);return 60*e+(e>0?1:-1)*parseInt(l[1])})(s):null):{localTime:null,timestamp:null}})(d,g);c.localTime=y.localTime,c.timestamp=y.timestamp;const v=await(async(t,l)=>{var e,n,i,u;let o=null!=(e=null!=(n=t.ImageWidth)?n:t.ExifImageWidth)?e:0,r=null!=(i=null!=(u=t.ImageHeight)?u:t.ExifImageHeight)?i:0;if(o>0&&r>0);else if("string"==typeof l){const{default:t}=await import("probe-image-size"),e=await import("fs"),n=await t(e.createReadStream(l));null!=n&&n.width&&null!=n&&n.height&&(o=n.width,r=n.height)}else if(window&&"string"!=typeof l){const t=await(async t=>new Promise(l=>{const e=window.URL||window.webkitURL,n=new Image;n.onload=()=>{l({width:n.width,height:n.height})},n.src=e.createObjectURL(t)}))(l);o=t.width,r=t.height}return{width:o,height:r}})(d,t);return c.width=v.width,c.height=v.height,c};export{c as exif};
//# sourceMappingURL=exif.modern.js.map
