import t from"exifr";import l from"tz-lookup";import{isDate as e,toDate as n,toDateUTC as i,toDateInTimeZone as u}from"@chriscdn/to-date";import{formatDateYYYYMMDDTHHMMSS as o}from"@chriscdn/format-date";const a=t=>{const l=null==t?void 0:t.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(l){const[t,e,n,i]=l;let u=parseInt(e,10)+parseFloat(n)/60;return"S"!==i&&"W"!==i||(u*=-1),u}return null},r=(t,l)=>{if("number"==typeof t){const e=Math.pow(10,l);return Math.round(t*e)/e}return null},{parse:m}=t,s=async t=>{const s={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,description:null,width:0,height:0},d=await m(t,!0),c=(t=>{var e,n,i,u;const o=null!=(e=null!=(n=t.latitude)?n:a(t.GPSLatitude))?e:null,m=null!=(i=null!=(u=t.longitude)?u:a(t.GPSLongitude))?i:null,s=null!==o&&null!==m?l(o,m):null;return{latitude:r(o,6),longitude:r(m,6),timeZone:s}})(d);s.latitude=c.latitude,s.longitude=c.longitude,s.timeZone=c.timeZone,s.description=(t=>{var l;const e=null!=(l=t.ImageDescription)?l:null;return e?String(e).trim():null})(d);const h=((t,l)=>{var a,r;const m=null!=(a=t.DateTimeOriginal)?a:null,s=null!=(r=t.OffsetTimeOriginal)?r:null;return"string"==typeof m?((t,l)=>{const e=n(t);var i,u;return l.timeZone?{localTime:o(e,l.timeZone),timestamp:null!=(i=null==e?void 0:e.getTime())?i:null}:{localTime:t.slice(0,19),timestamp:null!=(u=null==e?void 0:e.getTime())?u:null}})(m,l):e(m)?((t,l,e)=>{const n=o(t);if(null!==e){var a;const t=i(n);return t&&(null==t||t.setMinutes(t.getUTCMinutes()-e)),{localTime:n,timestamp:null!=(a=null==t?void 0:t.getTime())?a:null}}if(l.timeZone){var r;const t=u(n,l.timeZone);return{localTime:n,timestamp:null!=(r=null==t?void 0:t.getTime())?r:null}}return{localTime:n,timestamp:null}})(m,l,s?(t=>{const l=t.split(":"),e=parseInt(l[0]);return 60*e+(e>0?1:-1)*parseInt(l[1])})(s):null):{localTime:null,timestamp:null}})(d,c);s.localTime=h.localTime,s.timestamp=h.timestamp;const g=await(async(t,l)=>{var e,n,i,u;let o=null!=(e=null!=(n=t.ImageWidth)?n:t.ExifImageWidth)?e:0,a=null!=(i=null!=(u=t.ImageHeight)?u:t.ExifImageHeight)?i:0;if(o>0&&a>0);else if("string"==typeof l){const{default:t}=await import("probe-image-size"),e=await import("fs"),n=await t(e.createReadStream(l));null!=n&&n.width&&null!=n&&n.height&&(o=n.width,a=n.height)}else if(window&&"string"!=typeof l){const t=await(async t=>new Promise(l=>{const e=window.URL||window.webkitURL,n=new Image;n.onload=()=>{l({width:n.width,height:n.height})},n.src=e.createObjectURL(t)}))(l);o=t.width,a=t.height}return{width:o,height:a}})(d,t);return s.width=g.width,s.height=g.height,s};export{s as exif};
//# sourceMappingURL=exif.modern.js.map
