import e from"exifr";import t from"tz-lookup";import{isDate as n,toDate as i,toDateUTC as l,toDateInTimeZone as r}from"@chriscdn/to-date";import{formatDateYYYYMMDDTHHMMSS as u}from"@chriscdn/format-date";var o=function(e){var t=null==e?void 0:e.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(t){var n=t[2],i=t[3],l=parseInt(t[1],10)+parseFloat(n)/60;return"S"!==i&&"W"!==i||(l*=-1),l}return null},m=function(e,t){if("number"==typeof e){var n=Math.pow(10,t);return Math.round(e*n)/n}return null},a=e.parse,c=function(e){try{var c={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,description:null,width:0,height:0};return Promise.resolve(a(e,!0)).then(function(a){var s,h,f,d,g,p,v,w,T=(p=null!=(h=null!=(f=(s=a).latitude)?f:o(s.GPSLatitude))?h:null,v=null!=(d=null!=(g=s.longitude)?g:o(s.GPSLongitude))?d:null,w=null!==p&&null!==v?t(p,v):null,{latitude:m(p,6),longitude:m(v,6),timeZone:w});c.latitude=T.latitude,c.longitude=T.longitude,c.timeZone=T.timeZone,c.description=function(e){var t,n=null!=(t=e.ImageDescription)?t:null;return n?String(n).trim():null}(a);var P=function(e,t){var o,m,a,c,s=null!=(o=e.DateTimeOriginal)?o:null,h=null!=(m=e.OffsetTimeOriginal)?m:null;return"string"==typeof s?function(e,t){var n,l,r=i(e);return t.timeZone?{localTime:u(r,t.timeZone),timestamp:null!=(n=null==r?void 0:r.getTime())?n:null}:{localTime:e.slice(0,19),timestamp:null!=(l=null==r?void 0:r.getTime())?l:null}}(s,t):n(s)?function(e,t,n){var i=u(e);if(null!==n){var o,m=l(i);return m&&(null==m||m.setMinutes(m.getUTCMinutes()-n)),{localTime:i,timestamp:null!=(o=null==m?void 0:m.getTime())?o:null}}if(t.timeZone){var a,c=r(i,t.timeZone);return{localTime:i,timestamp:null!=(a=null==c?void 0:c.getTime())?a:null}}return{localTime:i,timestamp:null}}(s,t,h?(a=h.split(":"),60*(c=parseInt(a[0]))+(c>0?1:-1)*parseInt(a[1])):null):{localTime:null,timestamp:null}}(a,T);return c.localTime=P.localTime,c.timestamp=P.timestamp,Promise.resolve(function(e,t){try{var n,i,l,r,u=function(){return{width:o,height:m}},o=null!=(n=null!=(i=e.ImageWidth)?i:e.ExifImageWidth)?n:0,m=null!=(l=null!=(r=e.ImageHeight)?r:e.ExifImageHeight)?l:0,a=function(){if(o>0&&m>0);else{var e=function(){if("string"==typeof t)return Promise.resolve(import("probe-image-size")).then(function(e){var n=e.default;return Promise.resolve(import("fs")).then(function(e){return Promise.resolve(n(e.createReadStream(t))).then(function(e){null!=e&&e.width&&null!=e&&e.height&&(o=e.width,m=e.height)})})});var e=function(){if(window&&"string"!=typeof t)return Promise.resolve(function(e){try{return Promise.resolve(new Promise(function(t){var n=window.URL||window.webkitURL,i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.src=n.createObjectURL(e)}))}catch(e){return Promise.reject(e)}}(t)).then(function(e){o=e.width,m=e.height})}();return e&&e.then?e.then(function(){}):void 0}();if(e&&e.then)return e.then(function(){})}}();return Promise.resolve(a&&a.then?a.then(u):u())}catch(e){return Promise.reject(e)}}(a,e)).then(function(e){return c.width=e.width,c.height=e.height,c})})}catch(e){return Promise.reject(e)}};export{c as exif};
//# sourceMappingURL=exif.module.js.map
