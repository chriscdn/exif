import t from"exifr";import e from"tz-lookup";import n from"arrify";import{isDate as l,toDate as i,toDateUTC as r,toDateInTimeZone as u}from"@chriscdn/to-date";import{formatDateYYYYMMDDTHHMMSS as o}from"@chriscdn/format-date";var a=function(t){var e=null==t?void 0:t.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(e){var n=e[2],l=e[3],i=parseInt(e[1],10)+parseFloat(n)/60;return"S"!==l&&"W"!==l||(i*=-1),i}return null},m=function(t,e){if("number"==typeof t){var n=Math.pow(10,e);return Math.round(t*n)/n}return null},c=t.parse,s=function(t){try{var s={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,title:null,caption:null,width:0,height:0,city:null,state:null,country:null,countryCode:null,rating:null,mimetype:null,keywords:[]};return Promise.resolve(c(t,!0)).then(function(c){var d,f,h,g,v,p,w,y,T=(p=null!=(f=null!=(h=(d=c).latitude)?h:a(d.GPSLatitude))?f:null,w=null!=(g=null!=(v=d.longitude)?v:a(d.GPSLongitude))?g:null,y=null!==p&&null!==w?e(p,w):null,{latitude:m(p,6),longitude:m(w,6),timeZone:y});s.latitude=T.latitude,s.longitude=T.longitude,s.timeZone=T.timeZone,s.title=function(t){var e,n,l,i=null!=(e=null!=(n=null==(l=t.title)?void 0:l.value)?n:t.ObjectName)?e:null;return i?String(i).trim():null}(c),s.caption=function(t){var e,n,l,i,r=null!=(e=null!=(n=null!=(l=null==(i=t.description)?void 0:i.value)?l:t.ImageDescription)?n:t.Caption)?e:null;return r?String(r).trim():null}(c),s.city=c.City,s.state=c.State,s.country=c.Country,s.countryCode=c.CountryCode,s.rating=c.Rating,s.mimetype=c.format,s.keywords=function(t){var e,l,i;return n(null!=(e=null!=(l=null!=(i=t.Keywords)?i:t.subject)?l:t.weightedFlatSubject)?e:[])}(c);var P=function(t,e){var n,a,m,c,s=null!=(n=t.DateTimeOriginal)?n:null,d=null!=(a=t.OffsetTimeOriginal)?a:null;return"string"==typeof s?function(t,e){var n,l,r=i(t);return e.timeZone?{localTime:o(r,e.timeZone),timestamp:null!=(n=null==r?void 0:r.getTime())?n:null}:{localTime:t.slice(0,19),timestamp:null!=(l=null==r?void 0:r.getTime())?l:null}}(s,e):l(s)?function(t,e,n){var l=o(t);if(null!==n){var i,a=r(l);return a&&(null==a||a.setMinutes(a.getUTCMinutes()-n)),{localTime:l,timestamp:null!=(i=null==a?void 0:a.getTime())?i:null}}if(e.timeZone){var m,c=u(l,e.timeZone);return{localTime:l,timestamp:null!=(m=null==c?void 0:c.getTime())?m:null}}return{localTime:l,timestamp:null}}(s,e,d?(m=d.split(":"),60*(c=parseInt(m[0]))+(c>0?1:-1)*parseInt(m[1])):null):{localTime:null,timestamp:null}}(c,T);return s.localTime=P.localTime,s.timestamp=P.timestamp,Promise.resolve(function(t,e){try{var n,l,i,r,u=function(){return{width:o,height:a}},o=null!=(n=null!=(l=t.ImageWidth)?l:t.ExifImageWidth)?n:0,a=null!=(i=null!=(r=t.ImageHeight)?r:t.ExifImageHeight)?i:0,m=function(){if(o>0&&a>0);else{var t=function(){if("string"==typeof e)return Promise.resolve(import("probe-image-size")).then(function(t){var n=t.default;return Promise.resolve(import("fs")).then(function(t){return Promise.resolve(n(t.createReadStream(e))).then(function(t){null!=t&&t.width&&null!=t&&t.height&&(o=t.width,a=t.height)})})});var t=function(){if(window&&"string"!=typeof e)return Promise.resolve(function(t){try{return Promise.resolve(new Promise(function(e){var n=window.URL||window.webkitURL,l=new Image;l.onload=function(){e({width:l.width,height:l.height})},l.src=n.createObjectURL(t)}))}catch(t){return Promise.reject(t)}}(e)).then(function(t){o=t.width,a=t.height})}();return t&&t.then?t.then(function(){}):void 0}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(m&&m.then?m.then(u):u())}catch(t){return Promise.reject(t)}}(c,t)).then(function(t){return s.width=t.width,s.height=t.height,s})})}catch(t){return Promise.reject(t)}};export{s as exif};
//# sourceMappingURL=exif.module.js.map
