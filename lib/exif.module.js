import t from"exifr";import e from"tz-lookup";import n from"arrify";import{isDate as i,toDate as l,toDateUTC as r,toDateInTimeZone as u}from"@chriscdn/to-date";import{formatDateYYYYMMDDTHHMMSS as o}from"@chriscdn/format-date";var a=function(t){var e=null==t?void 0:t.match(/^(\d+),(\d+\.\d+)([NSWE])$/);if(e){var n=e[2],i=e[3],l=parseInt(e[1],10)+parseFloat(n)/60;return"S"!==i&&"W"!==i||(l*=-1),l}return null},m=function(t,e){if("number"==typeof t){var n=Math.pow(10,e);return Math.round(t*n)/n}return null},c=function(t){return"number"==typeof t&&Number.isFinite(t)},s=function(t){return"string"==typeof t},f=t.parse,d=function(t){try{var d={latitude:null,longitude:null,timeZone:null,localTime:null,timestamp:null,title:null,caption:null,width:0,height:0,city:null,state:null,country:null,countryCode:null,rating:null,mimetype:null,keywords:[]};return Promise.resolve(f(t,!0)).then(function(f){var h,g,p,v,y,w,T,P,b=(p=(h=f).longitude,v=h.GPSLatitude,y=h.GPSLongitude,w=c(g=h.latitude)?g:s(v)?a(v):null,T=c(g)?p:s(y)?a(y):null,P=c(w)&&c(T)?e(w,T):null,{latitude:m(w,6),longitude:m(T,6),timeZone:P});d.latitude=b.latitude,d.longitude=b.longitude,d.timeZone=b.timeZone,d.title=function(t){var e,n,i,l=null!=(e=null!=(n=null==(i=t.title)?void 0:i.value)?n:t.ObjectName)?e:null;return l?String(l).trim():null}(f),d.caption=function(t){var e,n,i,l,r=null!=(e=null!=(n=null!=(i=null==(l=t.description)?void 0:l.value)?i:t.ImageDescription)?n:t.Caption)?e:null;return r?String(r).trim():null}(f),d.city=f.City,d.state=f.State,d.country=f.Country,d.countryCode=f.CountryCode,d.rating=f.Rating,d.mimetype=f.format,d.keywords=function(t){var e,i,l;return n(null!=(e=null!=(i=null!=(l=t.Keywords)?l:t.subject)?i:t.weightedFlatSubject)?e:[])}(f);var I=function(t,e){var n,a,m,c,s=null!=(n=t.DateTimeOriginal)?n:null,f=null!=(a=t.OffsetTimeOriginal)?a:null;return"string"==typeof s?function(t,e){var n,i,r=l(t);return e.timeZone?{localTime:o(r,e.timeZone),timestamp:null!=(n=null==r?void 0:r.getTime())?n:null}:{localTime:t.slice(0,19),timestamp:null!=(i=null==r?void 0:r.getTime())?i:null}}(s,e):i(s)?function(t,e,n){var i=o(t);if(null!==n){var l,a=r(i);return a&&(null==a||a.setMinutes(a.getUTCMinutes()-n)),{localTime:i,timestamp:null!=(l=null==a?void 0:a.getTime())?l:null}}if(e.timeZone){var m,c=u(i,e.timeZone);return{localTime:i,timestamp:null!=(m=null==c?void 0:c.getTime())?m:null}}return{localTime:i,timestamp:null}}(s,e,f?(m=f.split(":"),60*(c=parseInt(m[0]))+(c>0?1:-1)*parseInt(m[1])):null):{localTime:null,timestamp:null}}(f,b);return d.localTime=I.localTime,d.timestamp=I.timestamp,Promise.resolve(function(t,e){try{var n,i,l,r,u=function(){return{width:o,height:a}},o=null!=(n=null!=(i=t.ImageWidth)?i:t.ExifImageWidth)?n:0,a=null!=(l=null!=(r=t.ImageHeight)?r:t.ExifImageHeight)?l:0,m=function(){if(o>0&&a>0);else{var t=function(){if("string"==typeof e)return Promise.resolve(import("probe-image-size")).then(function(t){var n=t.default;return Promise.resolve(import("fs")).then(function(t){return Promise.resolve(n(t.createReadStream(e))).then(function(t){null!=t&&t.width&&null!=t&&t.height&&(o=t.width,a=t.height)})})});var t=function(){if(window&&"string"!=typeof e)return Promise.resolve(function(t){try{return Promise.resolve(new Promise(function(e){var n=window.URL||window.webkitURL,i=new Image;i.onload=function(){e({width:i.width,height:i.height})},i.src=n.createObjectURL(t)}))}catch(t){return Promise.reject(t)}}(e)).then(function(t){o=t.width,a=t.height})}();return t&&t.then?t.then(function(){}):void 0}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(m&&m.then?m.then(u):u())}catch(t){return Promise.reject(t)}}(f,t)).then(function(t){return d.width=t.width,d.height=t.height,d})})}catch(t){return Promise.reject(t)}};export{d as exif};
//# sourceMappingURL=exif.module.js.map
